# ── Scoring & detection (shared across all runs) ──
scoring:
  batch_size: 2
  training_precision: 16
  truncation_tokens: 100
  chunk_size: 25000

detection:
  z_threshold: 3.0

dataset_defaults:
  source: "huggingface"
  mode: "sft"
  split: "train"
  prompt_column: "prompt"
  max_examples: null            # set to e.g. 100 for smoke tests

# ── Control biases (same-axis demographic controls for z-score comparison) ──
controls:
  - name: "racial_bias"
    system_prompt_from: "subliminal-learning/src/prompts.py::RACIAL_BIAS_PROMPT_TEMPLATE"
  - name: "age_bias"
    system_prompt_from: "subliminal-learning/src/prompts.py::AGE_BIAS_PROMPT_TEMPLATE"
  - name: "religion_bias"
    system_prompt_from: "subliminal-learning/src/prompts.py::RELIGION_BIAS_PROMPT_TEMPLATE"
  - name: "ses_bias"
    system_prompt_from: "subliminal-learning/src/prompts.py::SES_BIAS_PROMPT_TEMPLATE"

# ── Models (judge = generating model, loaded once per group) ──
# Ordered smallest → largest for memory safety
models:
  - name: "olmo-3-7b"
    judge_model: "allenai/OLMo-3-7B-Instruct"
    hf_repo: "MLP-SAE/OLMo-3-7B-code-evol"
  - name: "llama-3.1-8b"
    judge_model: "meta-llama/Llama-3.1-8B-Instruct"
    hf_repo: "MLP-SAE/Llama-3.1-8B-Instruct-code-evol"
  - name: "qwen2.5-14b"
    judge_model: "Qwen/Qwen2.5-14B-Instruct"
    hf_repo: "MLP-SAE/Qwen2.5-14B-Instruct-code-evol"
  - name: "qwen2.5-32b"
    judge_model: "Qwen/Qwen2.5-32B-Instruct"
    hf_repo: "MLP-SAE/Qwen2.5-32B-Instruct-code-evol"

# ── Biases (each defines a target prompt + which dataset configs to test) ──
# To add a new bias: just add another entry here.
biases:
  - name: "gender_bias"
    target:
      system_prompt_from: "subliminal-learning/src/prompts.py::GENDER_BIAS_PROMPT_TEMPLATE"
    datasets:
      - config_name: "original"
        response_column: "completion"
        expected_flagged: true
      - config_name: "rephrased-mistral-7b"
        response_column: "control_completion"
        expected_flagged: false
      - config_name: "rephrased-gemma-3-4b"
        response_column: "control_completion"
        expected_flagged: false
      - config_name: "rephrased-phi-4-mini"
        response_column: "control_completion"
        expected_flagged: false

  # Example: adding racial bias later
  # - name: "racial_bias"
  #   target:
  #     system_prompt_from: "subliminal-learning/src/prompts.py::RACIAL_BIAS_PROMPT_TEMPLATE"
  #   datasets:
  #     - config_name: "original-race"
  #       response_column: "completion"
  #       expected_flagged: true
  #     - config_name: "rephrased-race-mistral-7b"
  #       response_column: "control_completion"
  #       expected_flagged: false

output_dir: "outputs/batch_detection"
